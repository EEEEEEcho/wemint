<view class="white_bgColor">
    <view class="detailHeader main_bgColor">
        <view class="detailHeader_left">
            <image class="detail_img" src="{{shopInfo.logo_path}}"></image>
        </view>
        <view class="detailHeader_mid">
            <view class="header_intro">
                <view class="header_intro_top">
                    <view class="minPrice fs_12">起送价 ￥{{shopInfo.min_price}}</view>
                    <view class="cosCost fs_12">配送￥{{fee}} 月售{{sumMonth}}单</view>
                </view>
                <view bindtap="collectShop" class="header_collect">
                    <icon class="iconfont {{isCollect==1?'icon-shoucang':'icon-shoucang1'}} fs_16 header_star {{isCollect==1?'isCollect':''}}" data-state="{{isCollect}}"></icon>
                </view>
            </view>
            <view class="header_ads fs_12">
                <text>地址:{{shopInfo.address}}</text>
                <view class="header_collect fs_12">收藏</view>
            </view>
        </view>
    </view>
    <swiper autoplay="true" class="marketSwiper" duration="300" interval="3000" vertical="true" wx:if="{{market.length>0?true:false}}">
        <swiper-item wx:for="{{market}}">
            <view class="ovhtext detail_active">
                <view class="detail_active_discount fs_12">
                    <text class="active_rule active_rule{{item.rule_id}}" wx:if="{{item.rule_name==undefined?false:true}}">{{item.rule_name}}</text>{{item.rule_desc}}{{item.notice}}</view>
            </view>
        </swiper-item>
    </swiper>
    <view class="midBar fs_14">
        <view bindtap="tabList" class="{{_title=='商品'?'midBar_item_on':''}} midBar_item" data-title="商品">商品</view>
        <view bindtap="tabList" class="{{_title=='评价'?'midBar_item_on':''}} midBar_item" data-title="评价">评价</view>
        <view bindtap="tabList" class="{{_title=='商家'?'midBar_item_on':''}} midBar_item" data-title="商家">商家</view>
    </view>
    <view hidden="{{_title=='商品'?false:true}}">
        <view class="section">
            <scroll-view class="section_left {{market.length>0?'sectionShort':'sectionTall'}} fs_14" scrollY="true">
                <view bindtap="chooseSort" class="chooseItem {{_id==item.goods_sort_id?'onChoose':'noChoose'}}" data-id="{{item.goods_sort_id}}" data-name="{{item.sort_name}}" wx:for="{{goodsClass}}">{{item.sort_name}}</view>
            </scroll-view>
            <scroll-view class="section_right {{market.length>0?'sectionShort':'sectionTall'}}" scrollY="true">
                <view class="goodsClassName fs_12">{{_name}}</view>
                <view bindtap="showGoodsDetail" class="white_bgColor goodsDetail" data-item="{{item}}" wx:if="{{shopInfo.shop_type==1?true:false}}" wx:for="{{goodsChoose}}">
                    <view class="goodsLeft">
                        <image src="{{item.goods_path}}"></image>
                    </view>
                    <view class="goodsMid fc_lgray">
                        <view class="goodsName fs_12 ovhtext">{{item.goods_name}}</view>
                        <view class="goodsGood">
                            <view class="fs_12">销量{{item.sale_count+item.add_order_count}}</view>
                            <view class="fs_12 fc_mgray noSale {{item.state==3||item.is_force_stock==2&&item.stock_count<=0?'show':'hide'}}">已售完</view>
                        </view>
                        <view catchtap="handletap" class="goodsPrice fs_12">
                            <view class="fc_red fs_14">￥{{item.price}}</view>
                            <view class="goodsChoose">
                                <icon catchtap="reduceOne" class="iconfont icon-iconless {{item.goods_sum>0?'show':'hide'}}" data-item="{{item}}" wx:if="{{item.is_attribute==1?true:false}}"></icon>
                                <icon catchtap="openShopCar" class="iconfont icon-iconless {{item.goods_sum>0?'show':'hide'}}" wx:else></icon>
                                <text class="fc_lgray {{item.goods_sum==0?'hide':'show'}}">{{item.goods_sum}}</text>
                                <icon catchtap="addOne" class="iconfont icon-zengjia {{item.state==3||item.is_force_stock==2&&item.stock_count<=0?'noGoods':''}}" data-item="{{item}}" wx:if="{{item.is_attribute==1?true:false}}"></icon>
                                <icon catchtap="chooseGoodsAttr" class="iconfont icon-zengjia {{item.state==3||item.is_force_stock==2&&item.stock_count<=0?'noGoods':''}}" data-item="{{item}}" wx:else></icon>
                            </view>
                        </view>
                    </view>
                </view>
                <view class="crossBox" wx:if="{{shopInfo.shop_type==2?true:false}}">
                    <view bindtap="showGoodsDetail" class="white_bgColor goodsDetailCross" data-item="{{item}}" wx:for="{{goodsChoose}}">
                        <view class="goodsCrossTop">
                            <image src="{{item.goods_path}}"></image>
                        </view>
                        <view class="goodsCrossBottom fc_lgray">
                            <view class="goodsCrossName fs_12 ovhtext">{{item.goods_name}}</view>
                            <view class="goodsCrossGood">
                                <view class="fs_12">销量{{item.sale_count+item.add_order_count}}</view>
                                <view class="fs_12 fc_mgray noSale {{item.state==3||item.is_force_stock==2&&item.stock_count<=0?'show':'hide'}}">已售完</view>
                            </view>
                            <view catchtap="handleTap" class="goodsCrossPrice fs_12">
                                <view class="fc_red fs_14">￥{{item.price}}</view>
                                <view class="goodsCrossChoose">
                                    <icon catchtap="reduceOne" class="iconfont icon-iconless {{item.goods_sum>0?'show':'hide'}}" data-item="{{item}}" wx:if="{{item.is_attribute==1?true:false}}"></icon>
                                    <icon catchtap="openShopCar" class="iconfont icon-iconless {{item.goods_sum>0?'show':'hide'}}" wx:else></icon>
                                    <text class="fc_lgray {{item.goods_sum==0?'hide':'show'}}">{{item.goods_sum}}</text>
                                    <icon catchtap="addOne" class="iconfont icon-zengjia {{item.state==3||item.is_force_stock==2&&item.stock_count<=0?'noGoods':''}}" data-item="{{item}}" wx:if="{{item.is_attribute==1?true:false}}"></icon>
                                    <icon catchtap="chooseGoodsAttr" class="iconfont icon-zengjia {{item.state==3||item.is_force_stock==2&&item.stock_count<=0?'noGoods':''}}" data-item="{{item}}" wx:else></icon>
                                </view>
                            </view>
                        </view>
                    </view>
                </view>
            </scroll-view>
        </view>
        <view bindtap="closeShopCar" class="maskLayer" hidden="{{openCar==1?false:true}}">
            <view catchtap="handleTap" class="shopCarMask">
                <view class="shopCar">
                    <view class="fs_14">购物车</view>
                    <view bindtap="delAllGoods" class="fs_12 fc_lgray">清空</view>
                </view>
                <scroll-view scrollY class="shopCarItem">
                    <view class="nowShopCarList fs_14" wx:for="{{nowShopCar.goods}}">
                        <view class="shopCarName">{{item.goods_name}}<text wx:if="{{item.goods_attr_name==undefined||item.goods_attr_name==''?false:true}}">({{item.goods_attr_name}})</text>
                        </view>
                        <view class="fc_red shopCarGoodsPrice">￥{{item.every_goodsPrice}}</view>
                        <view class="fs_12 fc_lgray sumChange">
                            <icon bindtap="reduceGoods" class="iconfont icon-iconless circle" data-item="{{item}}"></icon>
                            <text>{{item.goods_sum}}</text>
                            <icon bindtap="increaceGoods" class="iconfont icon-zengjia circle" data-item="{{item}}"></icon>
                        </view>
                    </view>
                </scroll-view>
            </view>
        </view>
        <view class="footer">
            <view bindtap="openShopCar" class="footerLeft">
                <image class="carImg" src="{{carSrc}}"></image>
                <view class="goodsNote">{{allshopCarSum}}</view>
            </view>
            <view class="fs_14 fc_red footerMid">￥{{sumPrice}}</view>
            <view bindtap="toSureOrder" class="{{sumPrice>=minPrice?'footerRightOn':'footerRightNo'}}" data-price="{{sumPrice}}">{{sumPrice>=minPrice?'结算':'￥'+minPrice+'起送'}}</view>
        </view>
    </view>
    <view hidden="{{_title=='评价'?false:true}}">
        <view class="shopScoreBg">
            <view class="shopScore">
                <view class="shopScoreLeft">
                    <view class="fs_12 tasteScore">
                        <text>口味</text>
                        <icon class="fc_main iconfont icon-five-star fs_14 scoreStar" wx:for="{{tasteStar}}"></icon>
                        <icon class="fc_main iconfont icon-bankexing fs_14 scoreStar" wx:if="{{tasteHarfStar}}"></icon>
                        <icon class="fc_main iconfont icon-icon-test fs_14 scoreStar" wx:for="{{tasteNoStar}}"></icon>
                        <text class="fc_main scoreText">{{tasteScore}}</text>
                    </view>
                    <view class="fs_12 speedScore">
                        <text>速度</text>
                        <icon class="fc_main iconfont icon-five-star fs_14 scoreStar" wx:for="{{speedStar}}"></icon>
                        <icon class="fc_main iconfont icon-bankexing fs_14 scoreStar" wx:if="{{speedHarfStar}}"></icon>
                        <icon class="fc_main iconfont icon-icon-test fs_14 scoreStar" wx:for="{{speedNoStar}}"></icon>
                        <text class="fc_main scoreText">{{speedScore}}</text>
                    </view>
                </view>
                <view class="shopScoreRight">
                    <view class="fc_main">{{aveTime}}</view>
                    <view class="fs_16">平均时长</view>
                </view>
            </view>
        </view>
        <view class="remark" wx:for="{{remark}}">
            <view class="remarkLeft">
                <image src="{{item.head_path}}"></image>
            </view>
            <view class="remarkSection">
                <view class="remarkHead">
                    <text class="fs_12 fc_mgray">{{item.nick_name}}</text>
                    <text class="fs_12 fc_lgray">{{item.create_time}}</text>
                </view>
                <view class="remarkStar fs_12">{{item.comments}}</view>
                <view class="remarkGoods fc_lblue fs_10 {{item.reply==''?'hide':'show'}}">店家回复:{{item.reply}}</view>
            </view>
        </view>
        <view class="fs_14 fc_mgray noRemark" wx:if="{{remark.length==0?true:false}}">暂无评价</view>
    </view>
    <view class="white_bgColor shopIntroduce fs_14" hidden="{{_title=='商家'?false:true}}">
        <view class="shopTel">电话： {{shopInfo.contact_tel}}<icon bindtap="callShop" class="iconfont icon-dianhua" data-tel="{{shopInfo.contact_tel}}"></icon>
        </view>
        <view class="shopAds">地址： {{shopInfo.address}}<icon bindtap="openShopAds" class="iconfont icon-dingwei" data-lat="{{shopInfo.map_lat}}" data-lon="{{shopInfo.map_lon}}"></icon>
        </view>
        <view class="shopTime">
            <view class="busTime">营业： 
        <view>
                    <view class="busTimeItem" wx:for="{{businessTime}}">{{item.startTime}}-{{item.endTime}}</view>
                </view>
            </view>
            <view class="shopState busing" wx:if="{{shopInfo.status==1?true:false}}">营业中</view>
            <view class="shopState booking" wx:if="{{shopInfo.status==2?true:false}}">可预订</view>
            <view class="shopState closing" wx:if="{{shopInfo.status==3?true:false}}">打烊中</view>
            <view class="shopState resting" wx:if="{{shopInfo.status==4?true:false}}">休息中</view>
        </view>
        <view class="shopQualification">商家资质：</view>
        <view class="shopQualificationBox" wx:if="{{ext.hasBusiness||ext.hasPermit}}">
            <image mode="widthFix" src="{{ext.business_path}}" wx:if="{{ext.hasBusiness}}"></image>
            <image mode="widthFix" src="{{ext.permit_path}}" wx:if="{{ext.hasPermit}}"></image>
        </view>
    </view>
    <view bindtap="closeChoose" class="maskLayer" wx:if="{{isChoose==1?true:fasle}}">
        <scroll-view scrollY catchtap="handleTap" class="chooseAttr">
            <view class="chooseAttrName fs_18 fb">{{chooseAttr.goods_name}}</view>
            <view class="fs_12 fc_lgray" wx:if="{{hasSpec}}">
        {{chooseAttr.attr.spec.goods_attr_name}}：
      </view>
            <view class="goodsSpec fs_12" wx:if="{{hasSpec}}">
                <view bindtap="goodsSpec" class="{{_specId==spec.goods_spec_id?'mainBtn':'noBtn'}} attrBtn" data-attrid="{{spec.goods_attr_id}}" data-money="{{spec.goods_spec_price}}" data-name="{{spec.goods_spec_name}}" data-specid="{{spec.goods_spec_id}}" wx:for="{{goodsSpec}}" wx:for-item="spec">{{spec.goods_spec_name}}</view>
            </view>
            <view wx:if="{{hasAttr}}" wx:for="{{goodsAttr}}">
                <view class="fs_12 fc_lgray">{{item.goods_attr_name}}：</view>
                <view class="goodsAttrSpec fs_12">
                    <view bindtap="goodsAttr" class="{{item._specAttrId==attr.goods_spec_id?'mainBtn':'noBtn'}} attrBtn" data-attrid="{{item.goods_attr_id}}" data-money="{{attr.goods_spec_price}}" data-name="{{attr.goods_spec_name}}" data-specid="{{attr.goods_spec_id}}" wx:for="{{item.goods_spec}}" wx:for-item="attr"> 
          {{attr.goods_spec_name}}</view>
                </view>
            </view>
            <view class="chooseSure">
                <view class="fc_red fs_16">
                    <text>￥{{chooseAttr.finalPrice}}</text>
                    <text class="fs_10 fc_lgray" wx:if="{{now_attr_name==''?false:true}}">({{now_attr_name}})</text>
                </view>
                <view bindtap="finishChoose" class="fs_14 finishChoose">选好了</view>
            </view>
        </scroll-view>
    </view>
    <view bindtap="closeDetail" class="maskLayer" wx:if="{{isShowDetail}}">
        <image bindtap="closeDetail" class="detailExit" src="../../images/exit.png"></image>
        <scroll-view scrollY catchtap="handleTap" class="clickGoodsDetail">
            <view class="goodsDetailHeader">
                <view class="fs_18 ovhtext detailName">{{goodsInfo.goods_name}}</view>
                <view bindtap="addInShopCar" class="addShopCar" data-item="{{goodsInfo}}">加入购物车          </view>
            </view>
            <view class="fs_12 detailDescribe">{{goodsInfo.describe}}</view>
            <view class="goodsImgBox" wx:if="{{goodsInfo.goods_more_img==' '||goodsInfo.goods_more_img==null?false:true}}">
                <image src="{{item}}" wx:for="{{goodsInfo.goods_more_img}}"></image>
            </view>
        </scroll-view>
    </view>
</view>
