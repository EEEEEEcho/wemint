<view class="fixedTopBorder"></view>
<import src="/components/wxParse/wxParse.wxml"></import>
<view class="container">
    <view style="position:relative;background:#fff;">
        <swiper autoplay="{{videoshow?flase:true}}" bindchange="videoguanbi" circular="true" class="{{timeLimitActivity?'swiper-box':''}}" duration="200" indicatorDots="{{productImgs.length<=1?'':true}}" interval="5000" style="height:{{bannerHeight}}px">
            <view wx:if="{{videoshow}}">
                <view class="ProVideoDiv" style="width:100%;height:100%;background-color:rgba(0,0,0,0.5);position:absolute;z-index:100;">
                    <video autoplay="true" bindended="videoguanbi" src="{{productInfo.Video}}" style="position:absolute;height:100%;width:100%;"></video>
                    <i bindtap="videoguanbi" class="iconfont icon-guanbi-copy" style="position:absolute;right:5px;top:5px;font-size:20px;color:rgba(255,255,255,0.8)"></i>
                </view>
            </view>
            <swiper-item wx:for="{{productImgs}}" wx:key="index">
                <view wx:if="{{index==0&&productInfo.Video!=''&&productInfo.Video!=null}}">
                    <i bindtap="videobofang" class="m-iconfont m-icon-bofang videobofang"></i>
                </view>
                <image bindload="onBannerImgLoad" class="slide-image" data-index="{{index}}" mode="aspectFit" src="{{item}}"></image>
            </swiper-item>
        </swiper>
        <view class="discount-limit-activity" wx:if="{{timeLimitActivity}}">
            <view class="discount-activity-money">
                <text style="font-size:24rpx;margin-left:20rpx;">￥</text>
                <text class="actual-price">{{PriceShow}}</text>
                <text class="act-original-price" style="margin-left:8rpx;">￥{{productInfo.MarketPrice}}</text>
            </view>
            <view class="activityTime">
                <view class="activitySurplus">距结束还剩</view>
                <view class="activity-con-txt">
                    <text class="shi">{{activityTime.hour}}</text>
                    <text class="activityDay">时</text>
                    <text class="shi">{{activityTime.minute}}</text>
                    <text class="activityDay">分</text>
                    <text class="shi">{{activityTime.second}}</text>
                    <text class="activityDay">秒</text>
                </view>
            </view>
        </view>
    </view>
    <view class="particulars-text">
        <text class="particulars-title">{{productInfo.Name}}</text>
        <text class="desc">{{productInfo.ProDesc}}</text>
        <view class="productprice">
            <view class="productLeft">
                <view class="prices-box">
                    <view style="display:inline-block;padding:6rpx 8rpx;color:#fff;background:#ff3829;border-radius:8rpx;font-size:24rpx;text-align:center;" wx:if="{{timeLimitActivity}}">限时折扣</view>
                    <view class="price" wx:if="{{!timeLimitActivity}}">
                        <text hidden="{{!hasPrice}}">￥</text>
                        <text>{{PriceShow}}</text>
                    </view>
                    <view class="oldprice protext" wx:if="{{!timeLimitActivity}}">
                        <text>{{productInfo.MarketPrice}}</text>
                    </view>
                </view>
                <view class="expressage protext">
                    <text class="protext">运费：</text>
                    <text>{{productInfo.FreightMoney||0}}</text>
                </view>
            </view>
            <view class="productRight">
                <view class="sales-volume protext">
                    <text class="protext">月销</text>
                    <text>{{productInfo.SalesCount}}</text>
                    <text class="protext">笔</text>
                </view>
                <view catchtap="share" class="expAndSales" wx:if="{{enableWxShare}}">
                    <view class="shareicon">
                        <icon class="iconfont icon-fenxiang"></icon>
                    </view>
                    <view class="share protext">{{language.TIPS_Sha}}</view>
                </view>
            </view>
        </view>
    </view>
    <view bindtap="fullreduct" class="fullreduction" wx:if="{{fullReductionFlag}}">
        <view class="speLeft">
            <text class="fullicon">{{fullIcon}}</text>
            <text class="fulltitle">{{fullReductTitle}}</text>
        </view>
        <icon class="iconfont icon-iconfont_arrow-right iconsize"></icon>
    </view>
    <view class="fullreduction" wx:if="{{activitStore}}">
        <view class="speLeft">
            <view class="fullicon">活动</view>
            <view class="activityTitle" style="display:inline-block;color:#666;">限时折扣</view>
        </view>
        <view bindtap="timeLimitStoreShow" style="color:#999;font-size:26rpx;">查看活动门店</view>
    </view>
    <view bindtap="discount" class="discount" wx:if="{{couponlist.length>0}}">
        <view class="disLeft">
            <icon class="iconfont icon-iconfont_coupon disIcon"></icon>
            <text class="title" style="font-size:28rpx;color:#666;">优惠券</text>
        </view>
        <icon class="iconfont icon-iconfont_arrow-right iconsize"></icon>
    </view>
    <view bindtap="choose" class="specification" wx:if="{{attrs.length>0}}">
        <view class="speLeft">
            <text class="titChoose">{{selectedAttrNames?'已选':'请选择规格'}}</text>
            <text>{{selectedAttrNames}}</text>
        </view>
        <icon class="iconfont icon-iconfont_arrow-right iconsize"></icon>
    </view>
    <view class="line" wx:if="{{attrs.length>0}}"></view>
    <view class="discountList {{flag4?'showParam':'hideParam'}}">
        <view class="dis-top">
            <view class="dis-title">优惠券</view>
            <view bindtap="close" class="markClose">
                <icon class="closeIcon iconfont icon-guanbi-copy"></icon>
            </view>
        </view>
        <scroll-view bindscrolltolower="onListScroll" class="coupon2" lowerThreshold="20" scrollY="true" style="height:100%">
            <view class="coupon-item border1px" wx:for="{{couponlist}}" wx:key="CouponID">
                <view class="item-title {{item.CanGet==1&&item.Available>0?'notget':''}} {{item.CanGet==0?'getJuan':''}} {{item.Available<=0?'getJuanHui':''}}">
                    <view class="title">
                        <view>
                            <text class="titleText">{{item.Amount}}{{item.Type==0?'折':'元'}}</text>
                            <text class="titleMoney">{{item.Type==0?'折扣券':'现金券'}}</text>
                        </view>
                    </view>
                    <view class="intro">
                        <view wx:if="{{item.OrderMoney!=0}}">订单满{{item.OrderMoney-0}}元可使用</view>
                        <view wx:if="{{item.OrderMoney==0}}">不限金额可使用</view>
                    </view>
                    <view class="coupon-time">
                        <view class="time">使用期限：{{item.EndTimeType==0?item.beginTime:''}} {{item.EndTimeType==0?'-':''}} {{item.timeLimit}}</view>
                    </view>
                </view>
                <view class="button">
                    <view bindtap="{{item.code===0?'':'getCoupon'}}" class="{{item.code===0?'getbtn1':'getbtn2'}} getbtn" data-couponid="{{item.CouponID}}" wx:if="{{item.countStatus==='100'&&item.code===1}}">领取</view>
                    <view class="hasGet" wx:if="{{item.countStatus==='300'||item.code==='100'}}">已领取</view>
                    <view class="hasGet" wx:elif="{{item.countStatus==='200'||item.code==='200'}}">已领完</view>
                </view>
            </view>
            <view class="couponGetOver" wx:if="{{list.length==0}}">
                <image mode="widthFix" src="{{baseUrl}}/images/wxapp/blank_15.png"></image>
                <view>暂无优惠卷可领取</view>
            </view>
        </scroll-view>
    </view>
    <view bindtap="close" class="mark {{flag||flag4||shareMarkFlag||fullReductFlag||timeLimitStoreShowFlag?'showMark':''}}"></view>
    <view class="fullreductDetail {{timeLimitStoreShowFlag?'showParam':'hideParam'}}">
        <view class="fullreduct-top">
            <view class="top-center">
        活动详情
      </view>
            <view bindtap="close" class="close">
                <icon class="closeIcon iconfont icon-guanbi-copy"></icon>
            </view>
        </view>
        <scroll-view class="paramChoose full-contant" lowerThreshold="20" scrollY="true">
            <view class="canuse-store" wx:if="{{storeList.length>0}}">
                <view class="canuse-store-title">适用门店</view>
                <view style="height:52rpx;line-height:52rpx;" wx:if="{{fullReductionInfo.activityBase.StoreType==0}}">
                    <text style="font-size:26rpx;color:#333;">所有门店参与该满减活动</text>
                </view>
                <view style="box-sizing:border-box;padding:12rpx 26rpx 20rpx 26rpx;">
                    <view style="margin-bottom:80px;">
                        <text class="store-item" wx:for="{{storeList}}" wx:key="index">{{item.Name}} </text>
                    </view>
                </view>
            </view>
        </scroll-view>
    </view>
    <view class="fullreductDetail {{fullReductFlag?'showParam':'hideParam'}}">
        <view class="fullreduct-top">
            <view class="top-center">
        活动详情
      </view>
            <view bindtap="close" class="close">
                <icon class="closeIcon iconfont icon-guanbi-copy"></icon>
            </view>
        </view>
        <scroll-view class="paramChoose full-contant" lowerThreshold="20" scrollY="true" style="height:720rpx;">
            <view class="canuse-store">
                <view class="canuse-store-title first-store-title">活动优惠</view>
            </view>
            <view class="fullItem fullItem-first" wx:if="{{showFullReductIcon}}">
                <text class="fullicon">满减</text>
                <text class="fulltitle">{{fullReductTitle}}</text>
            </view>
            <view class="full-free fullItem" wx:if="{{fullGiftFlag}}">
                <text class="fullicon">满送</text>
                <view class="full-free-list">
                    <label wx:for="{{fullReductionInfo.activityDiscounts}}" wx:key="index">
                        <view class="full-free-item" wx:if="{{item.GiftType=='2'&&item.list.length>0}}">
                            <text class="fulltitle">满{{item.Threshold}}送赠品一个，送完即止</text>
                            <text catchtap="goProductDetails" class="go-product-detail" data-productid="{{item.list[0].id}}">查看赠品</text>
                        </view>
                        <view class="full-free-item" wx:if="{{item.GiftType=='1'}}">
                            <text class="fulltitle">满{{item.Threshold}}送优惠券，送完即止</text>
                        </view>
                    </label>
                </view>
            </view>
            <view class="fullItem" wx:if="{{freeFeightFlag}}">
                <text class="fullicon">免邮</text>
                <text class="fulltitle">满{{minFreeFeight}}免邮</text>
            </view>
            <view bindtap="goActiveList" class="go-active-list">
                <text>进入会场</text>
                <image class="go-active-img" src="{{baseUrl}}/images/wxapp/fullactiveicon.png"></image>
            </view>
            <view class="canuse-store">
                <view class="canuse-store-title">活动时间</view>
                <view class="active-time">{{fullReductionInfo.activityBase.StartTime}} 至 {{fullReductionInfo.activityBase.EndTime}}</view>
            </view>
            <view class="canuse-store" wx:if="{{fullReductionInfo.activityStore.length>0}}">
                <view class="canuse-store-title">适用门店</view>
                <view style="box-sizing:border-box;padding:12rpx 26rpx 20rpx 26rpx;">
                    <view style="height:52rpx;line-height:52rpx;" wx:if="{{fullReductionInfo.activityBase.StoreType==0}}">
                        <text style="font-size:26rpx;color:#333;">所有门店参与该满减活动</text>
                    </view>
                    <view wx:if="{{fullReductionInfo.activityBase.StoreType==1}}">
                        <text class="store-item" wx:for="{{fullReductionInfo.activityStore}}" wx:key="index">{{item.Name}} </text>
                    </view>
                </view>
            </view>
        </scroll-view>
    </view>
    <view class="product-attrs {{flag?'showParam':'hideParam'}}">
        <view class="product-conTop border1px">
            <view class="top-left">
                <view class="img">
                    <image mode="aspectFit" src="{{attrImg?attrImg:proImg}}"></image>
                </view>
                <view class="content">
                    <view class="price">
                        <text hidden="{{!hasPrice}}">￥</text>
                        <text>{{PriceShow2?PriceShow2:PriceShow}}</text>
                    </view>
                    <view class="inventory">
                        <text>库存：</text>
                        <text>{{ProductQuantity}}</text>
                        <text>件</text>
                    </view>
                    <view class="hasChoose" wx:if="{{productInfo.Attrs.length>0}}">
                        <text>{{selectedAttrNames?'已选：':'请选择规格'}}</text>
                        <text class="message">{{selectedAttrNames}}</text>
                    </view>
                </view>
            </view>
            <view bindtap="close" class="close">
                <icon class="closeIcon iconfont icon-guanbi-copy"></icon>
            </view>
        </view>
        <scroll-view class="paramChoose" lowerThreshold="20" scrollY="true" style="height: {{productInfo.Attrs.length>=2?'672rpx':'650rpx'}}">
            <view class="pro-attrs" data-index="{{index}}" wx:for="{{attrs}}" wx:key="AttrKeyID">
                <view class="attr-name">{{item.AttrKeyName}}</view>
                <view class="attr-vals">
                    <view catchtap="onAttrChange" class="attr-val {{attr.getActive(selectedAttrs,attritem.AttrKeyID,attritem.AttrValID,idx)}} {{attr.getDisabled(attritem.AttrValID,noQuantityList)}}" data-attrkeyid="{{attritem.AttrKeyID}}" data-attrvalid="{{attritem.AttrValID}}" wx:for="{{item.AttrVals}}" wx:for-index="idx" wx:for-item="attritem" wx:key="AttrValID">{{attritem.AttrValName}}</view>
                </view>
            </view>
            <view class="{{productInfo.Attrs.length>=1?'chooseCounts':''}} chooseCount">
                <view class="attr-name">数量</view>
                <view class="btn">
                    <view bindtap="decrease" class="decrease {{minusStatus}}">-</view>
                    <input bindblur="blurManual" bindchange="bindManual" type="number" value="{{count}}"></input>
                    <view bindtap="increase" class="increase {{canNoClick}} normal">+</view>
                    <view class="xiangou" wx:if="{{LimitNumberData&&LimitNumberData.buy_limit>0||productInfo.BuyLimit>0}}"> 
            限购：{{LimitNumberData&&LimitNumberData.buy_limit>0?LimitNumberData.buy_limit:productInfo.BuyLimit}} 件
          </view>
                </view>
            </view>
        </scroll-view>
        <view class="chooseBuy" style="{{!isAgentClient?'':'display:block;width:100%'}}" wx:if="{{flag}}">
            <view bindtap="addToCart" class="addToCart" wx:if="{{!isAgentClient}}">加入购物车</view>
            <view bindtap="buyNow" class="buyNow" style="{{!isAgentClient?'':'width:100%'}}">立即购买</view>
        </view>
        <view bindtap="addToCartContent" class="sureBuy" data-identifying="true" wx:if="{{flag2}}">
            <view class="sure">确定</view>
        </view>
        <view bindtap="buyNow" class="sureBuy " wx:if="{{flag3}}">
            <view class="sure">确定</view>
        </view>
    </view>
    <view class="sharePopout {{shareMarkFlag?'showPopout':'hidePopout'}}">
        <view class="btnGroup">
            <button catchtap="sharetoFriend" class="btns" openType="share">
                <view class="img">
                    <image src="{{baseUrl}}/images/wxapp/fx.png"></image>
                </view>
                <text class="words">{{language.TIPS_SendToFriend}}</text>
            </button>
            <view catchtap="shareHfive" class="btns shareHfive">
                <view class="img">
                    <image src="{{baseUrl}}/images/wxapp/bc.png"></image>
                </view>
                <text class="words">{{language.TIPS_ShaPoster}}</text>
            </view>
        </view>
        <view catchtap="close" class="cancelBtn">取消</view>
    </view>
    <view class="address_list" wx:if="{{StoreSetting==='1'}}">
        <view class="border1px" style="width:100%;display:flex;padding:26rpx 0;">
            <image src="{{SiteLogo}}" style="width:100rpx;height:100rpx;border-radius:14rpx"></image>
            <view bindtap="toposition" style="width:86%;box-sizing: border-box">
                <view class="addess_top_in">
                    <view class="address_list_name">
                        <view class="dis_in name">{{options.Name}}</view>
                    </view>
                    <view class="address_list_range" wx:if="{{options.distance<=10}}">{{options.distance>1?options.distance+'km':options.distance*1000+'m'}}</view>
                    <view class="address_list_range" wx:if="{{options.distance>10}}">>10km</view>
                </view>
                <view class="address_detial">
                    <view class="address_detial_in" style="position:relative;">
                        <view class="detial_text">{{options.start_address}}</view>
                        <view class="iconfont icon-iconfont_arrow-right detial_r" style="position:absolute;right:0"></view>
                    </view>
                </view>
            </view>
        </view>
        <view bindtap="tochooseStorePage" style="height:88rpx;line-height:88rpx;background:#fff;overflow:hidden;">
            <view style="font-size:26rpx;color:#333;float:left;">查看全部门店</view>
            <view style="font-size:26rpx;color:#999;float:right;padding-right:20rpx;display:flex;justify-items:center;justify-content:center;">
                <view>{{nearbyStoreNumber==0?'0家门店':nearbyStoreNumber+'家门店'}}</view>
                <view class="iconfont icon-iconfont_arrow-right"></view>
            </view>
        </view>
    </view>
    <view class="particulars-page">
        <view class="particulars-title border1px {{timestaus==false?'timestaus':''}}">
            <text bindtap="navbarTap" class="item {{currentTab==0?'active':''}}" data-idx="0">商品详情</text>
            <text bindtap="navbarTap" class="item {{currentTab==1?'active':''}}" data-idx="1">产品参数</text>
        </view>
        <view class="particulars-content" hidden="{{currentTab!=0}}">
            <rich-text nodes="{{deContent}}" type="text"></rich-text>
        </view>
        <view class="product-parameter " hidden="{{currentTab!=1}}">
            <view wx:if="{{productInfo.ParamList.length!=0}}">
                <view class="paramList  {{index<productInfo.ParamList.length-1?'border1px':''}}" wx:for="{{productInfo.ParamList}}" wx:key="ID">
                    <view class="pro-name">{{item.Name}}</view>
                    <view class="pro-content">{{item.Value}}</view>
                </view>
            </view>
            <view class="noParam" wx:if="{{productInfo.ParamList.length==0}}">
                <text>暂无参数</text>
            </view>
        </view>
    </view>
    <view class="product-count-insufficient" wx:if="{{sellOutFlag}}">
    商品已售罄
  </view>
    <view class="footnav">
        <view class="footLeft">
            <view catchtap="backToHome" class="backToHome">
                <icon class="iconfont icon-iconfont_homepage"></icon>
                <text>首页</text>
            </view>
            <view>
                <view catchtap="{{collection?'CanleCollection':'AddCollection'}}" class="favorite" data-ProID="{{productInfo.ProductID}}">
                    <icon class="iconfont {{collection?'icon-iconfont_favorite-fi':'icon-iconfont_favorite'}}  favorIcon {{collection?'collected':''}}"></icon>
                    <text>收藏</text>
                </view>
            </view>
            <view catchtap="shopCart" class="shopCar">
                <icon class="iconfont icon-iconfont_cart cartIcon"></icon>
                <text>购物车</text>
                <view class="num" wx:if="{{cartnum!=0&&cartnum<100}}">{{cartnum}}</view>
                <view class="num2" wx:if="{{cartnum!=0&&cartnum>=100}}"></view>
            </view>
        </view>
        <view class="footMiddle {{sellOutFlag?'opacityColor':''}}">
            <view bindtap="addToshopCart" class="addToCart">加入购物车</view>
        </view>
        <view class="footRight {{sellOutFlag?'opacityColor':''}}">
            <view bindtap="buyNow2" class="buyNow">立即购买</view>
        </view>
    </view>
</view>
<include src="/pages/template/floatLayer.wxml"></include>
<include src="/pages/template/getUserInfo.wxml"></include>
<include src="/pages/common/popout/index.wxml"></include>
<include src="/pages/common/phoneauthorization/index.wxml"></include>
<wxs module="attr">
var getActive = (function(selectedAttrs, curAttrKeyID, curAttrValID, index) {
    var active = '';
    if (!selectedAttrs && index == 0) active = 'ordinaryactive';
    else if (selectedAttrs && selectedAttrs[((nt_0 = (curAttrKeyID), null == nt_0 ? undefined : 'number' === typeof nt_0 ? nt_0 : "" + nt_0))] == curAttrValID) active = 'ordinaryactive';;
    return (active)
});
module.exports.getActive = getActive;
var getDisabled = (function(curAttrValID, noQuantityList) {
    if (!noQuantityList) return;;
    var disabled = '';
    for (var i = 0; i < noQuantityList.length; i++) {
        if (noQuantityList[((nt_1 = (i), null == nt_1 ? undefined : 'number' === typeof nt_1 ? nt_1 : "" + nt_1))].AttrValID == curAttrValID) disabled = 'no-quantity';
    };
    return (disabled)
});
module.exports.getDisabled = getDisabled;
</wxs>